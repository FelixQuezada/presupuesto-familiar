<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presupuesto Familiar</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Icon = ({ name, className = "", size = 24 }) => {
            const iconElement = lucide.createElement(name);
            return React.createElement('span', {
                className: className,
                dangerouslySetInnerHTML: { __html: iconElement.outerHTML },
                style: { width: size, height: size, display: 'inline-block' }
            });
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-lg shadow ${className}`}>
                {children}
            </div>
        );

        const CardHeader = ({ children, className = "" }) => (
            <div className={`px-6 py-4 border-b border-gray-200 ${className}`}>
                {children}
            </div>
        );

        const CardTitle = ({ children, className = "" }) => (
            <h3 className={`text-lg font-semibold ${className}`}>
                {children}
            </h3>
        );

        const CardContent = ({ children, className = "" }) => (
            <div className={`px-6 py-4 ${className}`}>
                {children}
            </div>
        );

        const PresupuestoFamiliar = () => {
            const [gastosPlanificados] = useState([
                // Gastos Fijos - Vivienda
                { id: 1, categoria: 'Departamento', monto: 2485, tipo: 'fijo', grupo: 'Vivienda' },
                { id: 2, categoria: 'Luz', monto: 250, tipo: 'fijo', grupo: 'Vivienda' },
                { id: 3, categoria: 'Mantenimiento', monto: 250, tipo: 'fijo', grupo: 'Vivienda' },
                { id: 4, categoria: 'Internet Casa', monto: 130, tipo: 'fijo', grupo: 'Vivienda' },
                
                // Gastos Fijos - Deudas
                { id: 5, categoria: 'Préstamo', monto: 1600, tipo: 'fijo', grupo: 'Deudas' },
                { id: 6, categoria: 'Tarjetas', monto: 650, tipo: 'variable', grupo: 'Deudas' },
                
                // Gastos Fijos - Educación
                { id: 7, categoria: 'Colegios', monto: 825, tipo: 'fijo', grupo: 'Educación' },
                { id: 8, categoria: 'UPC-Beto', monto: 925, tipo: 'fijo', grupo: 'Educación' },
                { id: 9, categoria: 'UPC-Yass', monto: 1306, tipo: 'fijo', grupo: 'Educación' },
                
                // Gastos Variables - Alimentación
                { id: 10, categoria: 'Comidas', monto: 1200, tipo: 'variable', grupo: 'Alimentación' },
                { id: 11, categoria: 'Desayunos', monto: 140, tipo: 'variable', grupo: 'Alimentación' },
                { id: 12, categoria: 'Huevos', monto: 50, tipo: 'variable', grupo: 'Alimentación' },
                { id: 13, categoria: 'Comida Perros', monto: 480, tipo: 'variable', grupo: 'Mascotas' },
                
                // Gastos Variables - Personal
                { id: 14, categoria: 'Compras Mensuales', monto: 550, tipo: 'variable', grupo: 'Personal' },
                { id: 15, categoria: 'Barbero', monto: 105, tipo: 'variable', grupo: 'Personal' },
                { id: 16, categoria: 'Gimnasios', monto: 220, tipo: 'variable', grupo: 'Personal' },
                { id: 17, categoria: 'Uñas Carol', monto: 100, tipo: 'variable', grupo: 'Personal' },
                
                // Gastos Variables - Telefonía
                { id: 18, categoria: 'Cel Beto', monto: 79, tipo: 'variable', grupo: 'Comunicaciones' },
                { id: 19, categoria: 'Cel Carol', monto: 37, tipo: 'variable', grupo: 'Comunicaciones' },
                { id: 20, categoria: 'Cel Yassell', monto: 37, tipo: 'variable', grupo: 'Comunicaciones' },
                
                // Gastos Variables - Transporte
                { id: 21, categoria: 'Transporte Yassell', monto: 100, tipo: 'variable', grupo: 'Transporte' },
                { id: 22, categoria: 'Combustible', monto: 400, tipo: 'variable', grupo: 'Transporte' },
                
                // Gastos Variables - Otros
                { id: 23, categoria: 'Entretenimientos', monto: 200, tipo: 'variable', grupo: 'Entretenimiento' },
                { id: 24, categoria: 'Baño Perros', monto: 80, tipo: 'variable', grupo: 'Mascotas' },
                { id: 25, categoria: 'Diamante', monto: 470, tipo: 'variable', grupo: 'Deportes' },
                { id: 26, categoria: 'Gastos Hormiga', monto: 200, tipo: 'variable', grupo: 'Otros' }
            ]);

            const [ingresos] = useState(9400);
            const [gastosReales, setGastosReales] = useState({});
            const [mesSeleccionado, setMesSeleccionado] = useState('Enero');
            const [datosGuardados, setDatosGuardados] = useState({});
            
            const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                          'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            const grupos = ['Vivienda', 'Deudas', 'Educación', 'Alimentación', 'Personal', 
                           'Comunicaciones', 'Transporte', 'Entretenimiento', 'Deportes', 'Mascotas', 'Otros'];

            // Cargar datos guardados al iniciar
            useEffect(() => {
                const datosGuardadosLocal = JSON.parse(localStorage.getItem('presupuesto-datos') || '{}');
                setDatosGuardados(datosGuardadosLocal);
                if (datosGuardadosLocal[mesSeleccionado]) {
                    setGastosReales(datosGuardadosLocal[mesSeleccionado]);
                }
            }, []);

            // Cambiar mes
            useEffect(() => {
                setGastosReales(datosGuardados[mesSeleccionado] || {});
            }, [mesSeleccionado, datosGuardados]);

            // Guardar datos cuando cambian los gastos reales
            useEffect(() => {
                const nuevoDatos = { ...datosGuardados, [mesSeleccionado]: gastosReales };
                setDatosGuardados(nuevoDatos);
                localStorage.setItem('presupuesto-datos', JSON.stringify(nuevoDatos));
            }, [gastosReales, mesSeleccionado]);

            const totalPlanificado = gastosPlanificados.reduce((sum, gasto) => sum + gasto.monto, 0);
            const totalReal = Object.values(gastosReales).reduce((sum, gasto) => sum + (gasto || 0), 0);
            const saldoReal = ingresos - totalReal;
            const saldoPlanificado = ingresos - totalPlanificado;

            const actualizarGastoReal = (id, valor) => {
                setGastosReales(prev => ({
                    ...prev,
                    [id]: parseFloat(valor) || 0
                }));
            };

            const getGastosPorGrupo = (grupo) => {
                return gastosPlanificados.filter(gasto => gasto.grupo === grupo);
            };

            const getTotalGrupo = (grupo, real = false) => {
                const gastosGrupo = getGastosPorGrupo(grupo);
                if (real) {
                    return gastosGrupo.reduce((sum, gasto) => sum + (gastosReales[gasto.id] || 0), 0);
                }
                return gastosGrupo.reduce((sum, gasto) => sum + gasto.monto, 0);
            };

            const getDiferencia = (id) => {
                const gasto = gastosPlanificados.find(g => g.id === id);
                const gastoReal = gastosReales[id] || 0;
                return gastoReal - gasto.monto;
            };

            const getColorDiferencia = (diferencia) => {
                if (diferencia > 0) return 'text-red-600 bg-red-50';
                if (diferencia < 0) return 'text-green-600 bg-green-50';
                return 'text-gray-600 bg-gray-50';
            };

            const limpiarDatosMes = () => {
                if (confirm(`¿Estás seguro que quieres limpiar todos los datos de ${mesSeleccionado}?`)) {
                    setGastosReales({});
                }
            };

            const exportarDatos = () => {
                const datos = {
                    mes: mesSeleccionado,
                    año: new Date().getFullYear(),
                    gastos: gastosPlanificados.map(gasto => ({
                        categoria: gasto.categoria,
                        grupo: gasto.grupo,
                        presupuestado: gasto.monto,
                        real: gastosReales[gasto.id] || 0,
                        diferencia: (gastosReales[gasto.id] || 0) - gasto.monto
                    })),
                    resumen: {
                        ingresos: ingresos,
                        totalPresupuestado: totalPlanificado,
                        totalReal: totalReal,
                        saldoReal: saldoReal
                    }
                };
                
                const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `presupuesto-${mesSeleccionado}-${new Date().getFullYear()}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="max-w-7xl mx-auto p-6 bg-gray-50 min-h-screen">
                    <div className="mb-6">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">Presupuesto Familiar</h1>
                        <div className="flex items-center gap-4">
                            <select 
                                value={mesSeleccionado}
                                onChange={(e) => setMesSeleccionado(e.target.value)}
                                className="px-4 py-2 border border-gray-300 rounded-lg bg-white"
                            >
                                {meses.map(mes => (
                                    <option key={mes} value={mes}>{mes}</option>
                                ))}
                            </select>
                            <button 
                                onClick={limpiarDatosMes}
                                className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600"
                            >
                                Limpiar Mes
                            </button>
                            <button 
                                onClick={exportarDatos}
                                className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                            >
                                Exportar Datos
                            </button>
                        </div>
                    </div>

                    {/* Resumen General */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <Card className="bg-blue-50 border-blue-200">
                            <CardContent className="p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-blue-600">Ingresos</p>
                                        <p className="text-2xl font-bold text-blue-800">S/ {ingresos.toLocaleString()}</p>
                                    </div>
                                    <Icon name="DollarSign" className="text-blue-600" size={32} />
                                </div>
                            </CardContent>
                        </Card>

                        <Card className="bg-orange-50 border-orange-200">
                            <CardContent className="p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-orange-600">Presupuestado</p>
                                        <p className="text-2xl font-bold text-orange-800">S/ {totalPlanificado.toLocaleString()}</p>
                                    </div>
                                    <Icon name="TrendingUp" className="text-orange-600" size={32} />
                                </div>
                            </CardContent>
                        </Card>

                        <Card className="bg-purple-50 border-purple-200">
                            <CardContent className="p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-purple-600">Gasto Real</p>
                                        <p className="text-2xl font-bold text-purple-800">S/ {totalReal.toLocaleString()}</p>
                                    </div>
                                    <Icon name="TrendingDown" className="text-purple-600" size={32} />
                                </div>
                            </CardContent>
                        </Card>

                        <Card className={`${saldoReal >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>
                            <CardContent className="p-4">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-sm text-gray-600">Saldo Real</p>
                                        <p className={`text-2xl font-bold ${saldoReal >= 0 ? 'text-green-800' : 'text-red-800'}`}>
                                            S/ {saldoReal.toLocaleString()}
                                        </p>
                                    </div>
                                    <Icon name={saldoReal >= 0 ? "TrendingUp" : "AlertCircle"} 
                                          className={saldoReal >= 0 ? "text-green-600" : "text-red-600"} 
                                          size={32} />
                                </div>
                            </CardContent>
                        </Card>
                    </div>

                    {/* Detalle por Grupos */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {grupos.map(grupo => (
                            <Card key={grupo} className="shadow-lg">
                                <CardHeader className="bg-gray-100">
                                    <CardTitle className="text-lg text-gray-800 flex justify-between items-center">
                                        <span>{grupo}</span>
                                        <div className="text-sm font-normal">
                                            <span className="text-orange-600">Plan: S/ {getTotalGrupo(grupo).toLocaleString()}</span>
                                            <span className="mx-2">|</span>
                                            <span className="text-purple-600">Real: S/ {getTotalGrupo(grupo, true).toLocaleString()}</span>
                                        </div>
                                    </CardTitle>
                                </CardHeader>
                                <CardContent className="p-0">
                                    <div className="max-h-80 overflow-y-auto">
                                        <table className="w-full">
                                            <thead className="bg-gray-50 sticky top-0">
                                                <tr>
                                                    <th className="text-left p-3 text-sm font-semibold text-gray-600">Categoría</th>
                                                    <th className="text-center p-3 text-sm font-semibold text-gray-600">Presupuesto</th>
                                                    <th className="text-center p-3 text-sm font-semibold text-gray-600">Real</th>
                                                    <th className="text-center p-3 text-sm font-semibold text-gray-600">Diferencia</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {getGastosPorGrupo(grupo).map(gasto => {
                                                    const diferencia = getDiferencia(gasto.id);
                                                    return (
                                                        <tr key={gasto.id} className="border-b border-gray-100 hover:bg-gray-50">
                                                            <td className="p-3 text-sm">
                                                                <div>
                                                                    <span className="font-medium">{gasto.categoria}</span>
                                                                    <span className={`ml-2 px-2 py-1 rounded-full text-xs ${
                                                                        gasto.tipo === 'fijo' ? 'bg-blue-100 text-blue-800' : 'bg-yellow-100 text-yellow-800'
                                                                    }`}>
                                                                        {gasto.tipo}
                                                                    </span>
                                                                </div>
                                                            </td>
                                                            <td className="p-3 text-center text-sm font-medium">S/ {gasto.monto}</td>
                                                            <td className="p-3 text-center">
                                                                <input
                                                                    type="number"
                                                                    placeholder="0"
                                                                    value={gastosReales[gasto.id] || ''}
                                                                    onChange={(e) => actualizarGastoReal(gasto.id, e.target.value)}
                                                                    className="w-20 p-1 text-center text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                                />
                                                            </td>
                                                            <td className="p-3 text-center">
                                                                {diferencia !== 0 && (
                                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getColorDiferencia(diferencia)}`}>
                                                                        {diferencia > 0 ? '+' : ''}{diferencia}
                                                                    </span>
                                                                )}
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                </CardContent>
                            </Card>
                        ))}
                    </div>

                    {/* Alertas y Recomendaciones */}
                    {saldoReal < 0 && (
                        <Card className="mt-6 border-red-300 bg-red-50">
                            <CardContent className="p-4">
                                <div className="flex items-center gap-2 text-red-800">
                                    <Icon name="AlertCircle" size={20} />
                                    <span className="font-semibold">¡Atención!</span>
                                </div>
                                <p className="text-red-700 mt-2">
                                    Estás excediendo tu presupuesto por S/ {Math.abs(saldoReal).toLocaleString()}. 
                                    Considera ajustar los gastos variables o revisar las categorías donde más te estás excediendo.
                                </p>
                            </CardContent>
                        </Card>
                    )}
                </div>
            );
        };

        ReactDOM.render(<PresupuestoFamiliar />, document.getElementById('root'));
    </script>
</body>
</html>
