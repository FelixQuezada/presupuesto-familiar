<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presupuesto Familiar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        select, button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            border: none;
        }

        button:hover {
            background-color: #2980b9;
        }

        .btn-danger {
            background-color: #e74c3c;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: #27ae60;
        }

        .btn-success:hover {
            background-color: #229954;
        }

        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-card h3 {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .summary-card .amount {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .neutral { color: #3498db; }

        .groups-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
        }

        .group-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .group-header {
            background-color: #34495e;
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .group-totals {
            font-size: 14px;
            opacity: 0.9;
        }

        .group-content {
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .categoria-cell {
            font-weight: 500;
        }

        .tipo-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .tipo-fijo {
            background-color: #3498db;
            color: white;
        }

        .tipo-variable {
            background-color: #f39c12;
            color: white;
        }

        .input-gasto {
            width: 80px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-align: center;
        }

        .diferencia {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .diferencia-positiva {
            background-color: #fee;
            color: #e74c3c;
        }

        .diferencia-negativa {
            background-color: #efe;
            color: #27ae60;
        }

        .alert {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #fee;
            border-left: 4px solid #e74c3c;
            color: #c0392b;
        }

        .alert h4 {
            margin-bottom: 10px;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .groups-container {
                grid-template-columns: 1fr;
            }
            
            .group-content {
                max-height: 300px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 8px 4px;
            }
            
            .input-gasto {
                width: 60px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Presupuesto Familiar</h1>
        
        <div class="controls">
            <select id="mesSelect">
                <option value="Enero">Enero</option>
                <option value="Febrero">Febrero</option>
                <option value="Marzo">Marzo</option>
                <option value="Abril">Abril</option>
                <option value="Mayo">Mayo</option>
                <option value="Junio">Junio</option>
                <option value="Julio">Julio</option>
                <option value="Agosto">Agosto</option>
                <option value="Septiembre">Septiembre</option>
                <option value="Octubre">Octubre</option>
                <option value="Noviembre">Noviembre</option>
                <option value="Diciembre">Diciembre</option>
            </select>
            
            <button onclick="limpiarMes()" class="btn-danger">üóëÔ∏è Limpiar Mes</button>
            <button onclick="exportarDatos()" class="btn-success">üìä Exportar</button>
            <button onclick="guardarDatos()">üíæ Guardar</button>
        </div>

        <div class="summary" id="summary">
            <!-- Se llena con JavaScript -->
        </div>

        <div class="groups-container" id="groupsContainer">
            <!-- Se llena con JavaScript -->
        </div>

        <div id="alertContainer"></div>
    </div>

    <script>
        // Datos del presupuesto
        const gastosPlanificados = [
            // Vivienda
            { id: 1, categoria: 'Departamento', monto: 2485, tipo: 'fijo', grupo: 'Vivienda' },
            { id: 2, categoria: 'Luz', monto: 250, tipo: 'fijo', grupo: 'Vivienda' },
            { id: 3, categoria: 'Mantenimiento', monto: 250, tipo: 'fijo', grupo: 'Vivienda' },
            { id: 4, categoria: 'Internet Casa', monto: 130, tipo: 'fijo', grupo: 'Vivienda' },
            
            // Deudas
            { id: 5, categoria: 'Pr√©stamo', monto: 1600, tipo: 'fijo', grupo: 'Deudas' },
            { id: 6, categoria: 'Tarjetas', monto: 650, tipo: 'variable', grupo: 'Deudas' },
            
            // Educaci√≥n
            { id: 7, categoria: 'Colegios', monto: 825, tipo: 'fijo', grupo: 'Educaci√≥n' },
            { id: 8, categoria: 'UPC-Beto', monto: 925, tipo: 'fijo', grupo: 'Educaci√≥n' },
            { id: 9, categoria: 'UPC-Yass', monto: 1306, tipo: 'fijo', grupo: 'Educaci√≥n' },
            
            // Alimentaci√≥n
            { id: 10, categoria: 'Comidas', monto: 1200, tipo: 'variable', grupo: 'Alimentaci√≥n' },
            { id: 11, categoria: 'Desayunos', monto: 140, tipo: 'variable', grupo: 'Alimentaci√≥n' },
            { id: 12, categoria: 'Huevos', monto: 50, tipo: 'variable', grupo: 'Alimentaci√≥n' },
            
            // Personal
            { id: 14, categoria: 'Compras Mensuales', monto: 550, tipo: 'variable', grupo: 'Personal' },
            { id: 15, categoria: 'Barbero', monto: 105, tipo: 'variable', grupo: 'Personal' },
            { id: 16, categoria: 'Gimnasios', monto: 220, tipo: 'variable', grupo: 'Personal' },
            { id: 17, categoria: 'U√±as Carol', monto: 100, tipo: 'variable', grupo: 'Personal' },
            
            // Comunicaciones
            { id: 18, categoria: 'Cel Beto', monto: 79, tipo: 'variable', grupo: 'Comunicaciones' },
            { id: 19, categoria: 'Cel Carol', monto: 37, tipo: 'variable', grupo: 'Comunicaciones' },
            { id: 20, categoria: 'Cel Yassell', monto: 37, tipo: 'variable', grupo: 'Comunicaciones' },
            
            // Transporte
            { id: 21, categoria: 'Transporte Yassell', monto: 100, tipo: 'variable', grupo: 'Transporte' },
            { id: 22, categoria: 'Combustible', monto: 400, tipo: 'variable', grupo: 'Transporte' },
            
            // Entretenimiento
            { id: 23, categoria: 'Entretenimientos', monto: 200, tipo: 'variable', grupo: 'Entretenimiento' },
            
            // Deportes
            { id: 25, categoria: 'Diamante', monto: 470, tipo: 'variable', grupo: 'Deportes' },
            
            // Mascotas
            { id: 13, categoria: 'Comida Perros', monto: 480, tipo: 'variable', grupo: 'Mascotas' },
            { id: 24, categoria: 'Ba√±o Perros', monto: 80, tipo: 'variable', grupo: 'Mascotas' },
            
            // Otros
            { id: 26, categoria: 'Gastos Hormiga', monto: 200, tipo: 'variable', grupo: 'Otros' }
        ];

        const ingresos = 9400;
        let mesActual = 'Enero';
        let gastosReales = {};
        let datosGuardados = {};

        // Cargar datos guardados
        function cargarDatos() {
            const datos = localStorage.getItem('presupuesto-familiar');
            if (datos) {
                datosGuardados = JSON.parse(datos);
                gastosReales = datosGuardados[mesActual] || {};
            }
        }

        // Guardar datos
        function guardarDatos() {
            datosGuardados[mesActual] = { ...gastosReales };
            localStorage.setItem('presupuesto-familiar', JSON.stringify(datosGuardados));
            alert('‚úÖ Datos guardados correctamente');
        }

        // Cambiar mes
        function cambiarMes() {
            mesActual = document.getElementById('mesSelect').value;
            gastosReales = datosGuardados[mesActual] || {};
            renderizar();
        }

        // Limpiar mes
        function limpiarMes() {
            if (confirm(`¬øEst√°s seguro que quieres limpiar todos los datos de ${mesActual}?`)) {
                gastosReales = {};
                renderizar();
            }
        }

        // Exportar datos
        function exportarDatos() {
            const datos = {
                mes: mesActual,
                a√±o: new Date().getFullYear(),
                resumen: obtenerResumen(),
                gastos: gastosPlanificados.map(gasto => ({
                    categoria: gasto.categoria,
                    grupo: gasto.grupo,
                    presupuestado: gasto.monto,
                    real: gastosReales[gasto.id] || 0,
                    diferencia: (gastosReales[gasto.id] || 0) - gasto.monto
                }))
            };
            
            const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `presupuesto-${mesActual}-${new Date().getFullYear()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Obtener resumen
        function obtenerResumen() {
            const totalPlanificado = gastosPlanificados.reduce((sum, gasto) => sum + gasto.monto, 0);
            const totalReal = Object.values(gastosReales).reduce((sum, gasto) => sum + (gasto || 0), 0);
            const saldoReal = ingresos - totalReal;
            
            return { totalPlanificado, totalReal, saldoReal };
        }

        // Actualizar gasto real
        function actualizarGasto(id, valor) {
            gastosReales[id] = parseFloat(valor) || 0;
            renderizar();
        }

        // Obtener gastos por grupo
        function getGastosPorGrupo(grupo) {
            return gastosPlanificados.filter(gasto => gasto.grupo === grupo);
        }

        // Obtener total de grupo
        function getTotalGrupo(grupo, real = false) {
            const gastosGrupo = getGastosPorGrupo(grupo);
            if (real) {
                return gastosGrupo.reduce((sum, gasto) => sum + (gastosReales[gasto.id] || 0), 0);
            }
            return gastosGrupo.reduce((sum, gasto) => sum + gasto.monto, 0);
        }

        // Renderizar todo
        function renderizar() {
            renderizarResumen();
            renderizarGrupos();
            renderizarAlertas();
        }

        // Renderizar resumen
        function renderizarResumen() {
            const resumen = obtenerResumen();
            const summaryHTML = `
                <div class="summary-card">
                    <h3>üí∞ INGRESOS</h3>
                    <div class="amount neutral">S/ ${ingresos.toLocaleString()}</div>
                </div>
                <div class="summary-card">
                    <h3>üìã PRESUPUESTADO</h3>
                    <div class="amount neutral">S/ ${resumen.totalPlanificado.toLocaleString()}</div>
                </div>
                <div class="summary-card">
                    <h3>üí∏ GASTO REAL</h3>
                    <div class="amount neutral">S/ ${resumen.totalReal.toLocaleString()}</div>
                </div>
                <div class="summary-card">
                    <h3>üí∞ SALDO</h3>
                    <div class="amount ${resumen.saldoReal >= 0 ? 'positive' : 'negative'}">
                        S/ ${resumen.saldoReal.toLocaleString()}
                    </div>
                </div>
            `;
            document.getElementById('summary').innerHTML = summaryHTML;
        }

        // Renderizar grupos
        function renderizarGrupos() {
            const grupos = [...new Set(gastosPlanificados.map(gasto => gasto.grupo))];
            
            const gruposHTML = grupos.map(grupo => {
                const gastosGrupo = getGastosPorGrupo(grupo);
                const totalPlan = getTotalGrupo(grupo);
                const totalReal = getTotalGrupo(grupo, true);
                
                const filasHTML = gastosGrupo.map(gasto => {
                    const gastoReal = gastosReales[gasto.id] || 0;
                    const diferencia = gastoReal - gasto.monto;
                    
                    return `
                        <tr>
                            <td class="categoria-cell">
                                ${gasto.categoria}
                                <span class="tipo-badge tipo-${gasto.tipo}">${gasto.tipo}</span>
                            </td>
                            <td style="text-align: center;">S/ ${gasto.monto}</td>
                            <td style="text-align: center;">
                                <input type="number" class="input-gasto" 
                                       value="${gastoReal || ''}" 
                                       placeholder="0"
                                       onchange="actualizarGasto(${gasto.id}, this.value)">
                            </td>
                            <td style="text-align: center;">
                                ${diferencia !== 0 ? `
                                    <span class="diferencia diferencia-${diferencia > 0 ? 'positiva' : 'negativa'}">
                                        ${diferencia > 0 ? '+' : ''}${diferencia}
                                    </span>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');
                
                return `
                    <div class="group-card">
                        <div class="group-header">
                            <span>${grupo}</span>
                            <div class="group-totals">
                                Plan: S/ ${totalPlan.toLocaleString()} | Real: S/ ${totalReal.toLocaleString()}
                            </div>
                        </div>
                        <div class="group-content">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Categor√≠a</th>
                                        <th style="text-align: center;">Presupuesto</th>
                                        <th style="text-align: center;">Real</th>
                                        <th style="text-align: center;">Diferencia</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filasHTML}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('groupsContainer').innerHTML = gruposHTML;
        }

        // Renderizar alertas
        function renderizarAlertas() {
            const resumen = obtenerResumen();
            const alertContainer = document.getElementById('alertContainer');
            
            if (resumen.saldoReal < 0) {
                alertContainer.innerHTML = `
                    <div class="alert">
                        <h4>‚ö†Ô∏è ¬°Atenci√≥n!</h4>
                        <p>Est√°s excediendo tu presupuesto por <strong>S/ ${Math.abs(resumen.saldoReal).toLocaleString()}</strong>. 
                        Considera ajustar los gastos variables o revisar las categor√≠as donde m√°s te est√°s excediendo.</p>
                    </div>
                `;
            } else {
                alertContainer.innerHTML = '';
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatos();
            document.getElementById('mesSelect').addEventListener('change', cambiarMes);
            renderizar();
        });

        // Auto-guardar cada minuto
        setInterval(() => {
            datosGuardados[mesActual] = { ...gastosReales };
            localStorage.setItem('presupuesto-familiar', JSON.stringify(datosGuardados));
        }, 60000);
    </script>
</body>
</html>
